# Configuracao do Pipeline Automatizado
# Sistema para processamento automatico de videos longos

# Estrutura de diretorios
directories:
  videos_full: "videos_full" # Videos .dav originais (entrada)
  videos_converted: "videos_converted" # Videos MP4 convertidos
  data_processing: "data_processing" # Dados temporarios de processamento
  output_dataset: "yolo_dataset" # Dataset final YOLO

# Conversao de videos DAV para MP4
conversion:
  use_ffmpeg: true # Tentar ffmpeg primeiro (melhor qualidade)
  fallback_opencv: true # Usar opencv se ffmpeg falhar
  codec: "libx264" # Codec H.264
  preset: "fast" # fast, medium, slow
  crf: 23 # Quality (18-28, menor = melhor qualidade)
  audio_codec: "aac"
  audio_bitrate: "128k"

# Configuracoes de chunking
chunking:
  chunk_duration_seconds: 180 # 3 minutos por chunk
  codec: "mp4v" # Codec H.264
  preserve_fps: true
  use_gpu: true # Se true, tentar usar ffmpeg + NVENC para extracao de chunks

# Configuracoes de filtragem de atividade
activity_filter:
  motion_threshold: 0.02 # 2% de pixels com movimento
  min_person_frames: 30 # Minimo de frames com pessoa detectada
  person_detection_model: "yolo11n.pt" # Modelo leve para deteccao rapida
  person_conf_threshold: 0.5 # AUMENTADO: 50% confidence minimo (antes: 0.3)
  sample_rate_motion: 10 # Processar 1 a cada N frames para motion detection
  sample_rate_person: 15 # Processar 1 a cada N frames para person detection
  # Filtros de qualidade de bbox
  min_bbox_area: 2000 # Minimo 2000 pixels (evita ruido)
  max_bbox_area: 500000 # Maximo 500k pixels (evita deteccoes de fundo)
  min_aspect_ratio: 0.3 # Minimo altura/largura (evita bboxes muito horizontais)
  max_aspect_ratio: 4.0 # Maximo altura/largura (evita bboxes muito verticais)
  # Corroboracao de movimento local para reduzir falsos positivos (posters/sombras)
  min_local_motion_ratio: 0.01 # Minimo de 1% de pixels com movimento dentro da bbox
  # Zonas para ignorar deteccoes (coordenadas normalizadas [x1,y1,x2,y2])
  ignore_zones: []
  ignore_overlap_threshold: 0.5 # Se overlap com zona >= 50%, ignorar

# Configuracoes de deteccao de eventos
event_detector:
  detector_model: "yolo11n.pt" # Modelo LEVE para velocidade (antes: yolo11m.pt)
  tracker: "bytetrack.yaml" # ByteTrack para tracking
  conf_threshold: 0.5 # AUMENTADO: 50% confidence minimo (antes: 0.35)
  iou_threshold: 0.5
  min_event_duration_seconds: 1.0 # AUMENTADO: min 1s (antes: 0.8s)
  sample_rate: 3 # Processar 1 a cada 3 frames (10 FPS) - OTIMIZACAO
  # Filtros de qualidade de bbox
  min_bbox_area: 2000 # Minimo 2000 pixels (evita ruido)
  max_bbox_area: 500000 # Maximo 500k pixels (evita deteccoes de fundo)
  min_aspect_ratio: 0.3 # Minimo altura/largura
  max_aspect_ratio: 4.0 # Maximo altura/largura
  # Filtros de tracking
  min_track_length: 15 # Minimo 15 deteccoes por track (0.5s @ 30fps)
  min_track_confidence_avg: 0.55 # Confianca media minima por track
  require_motion_for_event: true # Exigir movimento minimo no track
  min_track_movement_pixels: 12.0 # Distancia minima do centro entre inicio e fim do track
  # Zonas para ignorar deteccoes (coordenadas normalizadas [x1,y1,x2,y2])
  ignore_zones: []
  ignore_overlap_threshold: 0.5

# Configuracoes de rotulagem automatica
auto_labeler:
  detector_model: "yolo11m.pt"
  # Heuristicas para classificacao inicial
  heuristics:
    normal_duration_max: 2.0 # Passou rapido = normal
    suspicious_duration_min: 10.0 # Tempo longo na area = suspeito
    suspicious_frame_threshold: 150 # Frames @ 30fps

# Configuracoes de integracao CVAT
cvat:
  enabled: false # Habilitar quando CVAT estiver configurado
  url: "http://localhost:8080"
  username: "admin"
  password: "admin"
  project_id: null
  labels:
    - "comportamento_normal"
    - "furto_discreto"
    - "furto_bolsa_mochila"
    - "furto_grupo_colaborativo"
    - "acoes_ambiguas_suspeitas"
    - "funcionario_reposicao"

# Configuracoes de logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "automated_pipeline.log"

# Configuracoes de performance
performance:
  max_workers: 4 # Paralelismo
  cache_enabled: true
  cache_size: 1000

# Gerenciamento de estado
state:
  file: "pipeline_state.json" # Arquivo de estado do processamento
  auto_resume: true # Retomar processamento automaticamente

# Configuracoes de revisao humana
review:
  auto_open: true # Abrir GUI de revisao automaticamente sem perguntar

# Configuracoes de tentativas (retries)
retries:
  detection:
    max_attempts: 3
    backoff_seconds: 8
  labeling:
    max_attempts: 3
    backoff_seconds: 5
#    __  ____ ____ _  _
#  / _\/ ___) ___) )( \
# /    \___ \___ ) \/ (
# \_/\_(____(____|____/
