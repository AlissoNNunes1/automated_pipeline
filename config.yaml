# Configuracao do Pipeline Automatizado
# Sistema para processamento automatico de videos longos

# Estrutura de diretorios
directories:
  videos_full: "videos_full" # Videos .dav originais (entrada)
  videos_converted: "videos_converted" # Videos MP4 convertidos
  data_processing: "data_processing" # Dados temporarios de processamento
  output_dataset: "yolo_dataset" # Dataset final YOLO

# Conversao de videos DAV para MP4
conversion:
  use_ffmpeg: true # true: usa ffmpeg (melhor qualidade). false: usa opencv direto
  fallback_opencv: true # true: tenta opencv se ffmpeg falhar. false: aborta em erro
  codec: "libx264" # Codec de video. libx264=H.264 (compatibilidade maxima)
  preset: "fast" # Velocidade de encoding. fast=rapido, medium=balanceado, slow=melhor compressao
  crf: 23 # Qualidade video (0-51). Menor=melhor qualidade/maior arquivo. 18=quase lossless, 28=comprimido
  audio_codec: "aac" # Codec de audio. aac=padrao moderno, mp3=alternativa
  audio_bitrate: "128k" # Taxa de bits audio. Maior=melhor qualidade. 128k=padrao, 256k=alta qualidade

# Configuracoes de chunking
chunking:
  chunk_duration_seconds: 180 # Duracao de cada chunk em segundos. Maior=menos chunks/mais memoria, menor=mais chunks/processamento fragmentado
  codec: "mp4v" # Codec para chunks. mp4v=rapido mas menos compativel, libx264=lento mas universal
  preserve_fps: true # true: mantem FPS original. false: pode alterar FPS (nao recomendado)
  use_gpu: true # true: usa NVENC (ffmpeg+GPU) para acelerar. false: usa CPU (mais lento)

# Configuracoes de filtragem de atividade
activity_filter:
  motion_threshold: 0.015 # Fracao de pixels com movimento (0.0-1.0). Menor=mais sensivel (aceita menos movimento), maior=descarta mais chunks estaticos
  min_person_frames: 20 # Minimo de frames com pessoa detectada. Menor=aceita passagens rapidas, maior=exige presenca prolongada
  person_detection_model: "yolo11n.pt" # Modelo YOLO. yolo11n=rapido/leve, yolo11m=balanceado, yolo11l=preciso/pesado
  person_conf_threshold: 0.35 # Confianca minima pessoa (0.0-1.0). Menor=mais deteccoes/falsos positivos, maior=apenas deteccoes certeiras
  sample_rate_motion: 10 # Processar 1 a cada N frames para motion. Menor=mais preciso/lento, maior=rapido/pode perder movimento sutil
  sample_rate_person: 15 # Processar 1 a cada N frames para deteccao pessoa. Menor=mais preciso/lento, maior=rapido
  # Filtros de qualidade de bbox
  min_bbox_area: 1500 # Area minima bbox em pixels. Menor=aceita pessoas distantes/pequenas, maior=descarta ruido pequeno
  max_bbox_area: 500000 # Area maxima bbox em pixels. Menor=descarta deteccoes grandes (fundo), maior=mais permissivo
  min_aspect_ratio: 0.25 # Proporcao altura/largura minima. Menor=aceita bboxes horizontais (pessoa deitada), maior=apenas verticais
  max_aspect_ratio: 5.0 # Proporcao altura/largura maxima. Menor=apenas proporcoes normais, maior=aceita bboxes muito verticais
  # Corroboracao de movimento local para reduzir falsos positivos (posters/sombras)
  min_local_motion_ratio: 0.008 # Movimento dentro do bbox (0.0-1.0). Menor=aceita objetos estaticos, maior=exige movimento real (elimina posters)

  ignore_overlap_threshold: 0.5 # Sobreposicao minima com zona ignorada (0.0-1.0). Menor=ignora bbox parcial, maior=ignora apenas bbox muito sobreposta

# Configuracoes de deteccao de eventos
event_detector:
  detector_model: "yolo11n.pt" # Modelo YOLO. yolo11n=rapido/leve, yolo11m=balanceado, yolo11l=preciso/pesado
  tracker: "bytetrack.yaml" # Algoritmo de tracking. bytetrack=robusto, botsort=alternativa
  conf_threshold: 0.35 # Confianca minima deteccao (0.0-1.0). Menor=mais deteccoes/falsos positivos, maior=apenas certeiras
  iou_threshold: 0.5 # IoU minimo para matching tracks (0.0-1.0). Menor=tracking rigoroso, maior=permite mais desvio entre frames
  min_event_duration_seconds: 0.6 # Duracao minima evento em segundos. Menor=captura passagens rapidas, maior=descarta eventos curtos
  sample_rate: 2 # Processar 1 a cada N frames. Menor=tracking preciso/lento, maior=rapido mas pode perder movimento
  # Filtros de qualidade de bbox
  min_bbox_area: 1000 # Area minima bbox em pixels. Menor=aceita pessoas distantes, maior=descarta deteccoes pequenas
  max_bbox_area: 500000 # Area maxima bbox em pixels. Menor=descarta deteccoes grandes, maior=aceita qualquer tamanho
  min_aspect_ratio: 0.22 # Proporcao altura/largura minima. Menor=aceita bboxes horizontais, maior=apenas verticais
  max_aspect_ratio: 5.0 # Proporcao altura/largura maxima. Menor=apenas proporcoes normais, maior=aceita muito verticais
  # Filtros de tracking
  min_track_length: 10 # Minimo de deteccoes no track. Menor=aceita aparicoes breves, maior=exige presenca prolongada
  min_track_confidence_avg: 0.40 # Confianca media minima track (0.0-1.0). Menor=aceita tracks incertos, maior=apenas tracks confiaveis
  require_motion_for_event: true # true: exige movimento minimo no track (elimina estaticos). false: aceita objetos parados
  min_track_movement_pixels: 5.0 # Movimento minimo centro track em pixels. Menor=aceita pouco movimento, maior=exige deslocamento significativo

# Configuracoes de rotulagem automatica
auto_labeler:
  detector_model: "yolo11m.pt" # Modelo YOLO para labeling. yolo11m=balanceado, yolo11l=mais preciso
  # Heuristicas para classificacao inicial
  heuristics:
    normal_duration_max: 2.0 # Duracao maxima em segundos para classificar como normal. Menor=mais restritivo, maior=aceita permanencias longas como normal
    suspicious_duration_min: 10.0 # Duracao minima em segundos para classificar como suspeito. Menor=marca eventos curtos suspeitos, maior=apenas permanencias longas
    suspicious_frame_threshold: 150 # Numero minimo frames para suspeito (@30fps = 5s). Menor=mais suspeitos, maior=exige permanencia prolongada

# Configuracoes de integracao CVAT
cvat:
  enabled: false # true: habilita upload automatico para CVAT. false: gera apenas arquivos locais
  url: "http://localhost:8080" # URL do servidor CVAT
  username: "admin" # Usuario CVAT
  password: "admin" # Senha CVAT
  project_id: null # ID do projeto CVAT (null=criar novo)
  labels: # Classes de rotulos disponiveis
    - "comportamento_normal"
    - "furto_discreto"
    - "furto_bolsa_mochila"
    - "furto_grupo_colaborativo"
    - "acoes_ambiguas_suspeitas"
    - "funcionario_reposicao"

# Configuracoes de logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "automated_pipeline.log"

# Configuracoes de performance
performance:
  max_workers: 4 # Numero maximo threads paralelas. Maior=mais rapido/mais memoria, menor=sequencial/menos memoria
  cache_enabled: true # true: armazena resultados em cache. false: recalcula sempre (mais lento)
  cache_size: 1000 # Tamanho maximo cache em entradas. Maior=mais memoria/menos recalculo, menor=economiza memoria

# Gerenciamento de estado
state:
  file: "pipeline_state.json" # Nome do arquivo JSON de estado
  auto_resume: true # true: retoma processamento do ultimo ponto. false: recomeca do zero (ignora estado anterior)

# Configuracoes de revisao humana
review:
  auto_open: true # true: abre GUI de revisao automaticamente ao gerar propostas. false: pergunta antes de abrir

# Configuracoes de tentativas (retries)
retries:
  detection:
    max_attempts: 3 # Numero maximo de tentativas em falha. Maior=mais resiliente/lento em erro, menor=falha rapido
    backoff_seconds: 8 # Tempo espera entre tentativas em segundos. Maior=recuperacao lenta, menor=retenta rapido
  labeling:
    max_attempts: 3 # Numero maximo de tentativas em falha
    backoff_seconds: 5 # Tempo espera entre tentativas em segundos
#    __  ____ ____ _  _
#  / _\/ ___) ___) )( \
# /    \___ \___ ) \/ (
# \_/\_(____(____|____/
